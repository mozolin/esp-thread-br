<!DOCTYPE html>
<html>
<head>
    <title>Thread mDNS Discovery</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .device { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .device-header { font-weight: bold; color: #2c3e50; }
        .timestamp { color: #7f8c8d; font-size: 0.9em; }
        .txt-record { background: #f8f9fa; padding: 5px; margin: 2px 0; font-family: monospace; }
        .connected { color: green; }
        .disconnected { color: red; }
    </style>
    <link href="favicon.ico" rel="icon">
</head>
<body>
    <h1>ðŸŽ¯ Thread mDNS Discovery</h1>
    <div id="status">Status: <span id="statusText" class="disconnected">Disconnected</span></div>
    <div id="devices"></div>

    <script>
        const devicesElement = document.getElementById('devices');
        const statusElement = document.getElementById('statusText');
        
        // ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ðº WebSocket ÑÐµÑ€Ð²ÐµÑ€Ñƒ
        const ws = new WebSocket('ws://localhost:3000');
        
        ws.onopen = function() {
            statusElement.textContent = 'Connected';
            statusElement.className = 'connected';
            console.log('WebSocket connected');
        };
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            if (data.type === 'mdns_response' && data.data.length > 0) {
                updateDevicesList(data.data);
            }
        };
        
        ws.onclose = function() {
            statusElement.textContent = 'Disconnected';
            statusElement.className = 'disconnected';
            console.log('WebSocket disconnected');
        };
        
        function updateDevicesList(devices) {
            devicesElement.innerHTML = '<h2>Discovered Thread Devices:</h2>';
            
            devices.forEach(device => {
                const deviceElement = document.createElement('div');
                deviceElement.className = 'device';
                
                let html = `
                    <div class="device-header">${device.name}</div>
                    <div class="timestamp">Discovered: ${new Date(device.timestamp).toLocaleString()}</div>
                    <div>Type: ${device.type}</div>
                `;
                
                if (device.ipv4) {
                    html += `<div>IPv4: ${device.ipv4}</div>`;
                }
                
                if (device.ipv6) {
                    html += `<div>IPv6: ${device.ipv6}</div>`;
                }
                
                if (device.txtRecords && device.txtRecords.length > 0) {
                    html += `<div>TXT Records:</div>`;
                    device.txtRecords.forEach(record => {
                        html += `<div class="txt-record">${record}</div>`;
                    });
                }
                
                deviceElement.innerHTML = html;
                devicesElement.appendChild(deviceElement);
            });
        }
        
        // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÐ¿Ð¸ÑÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 30 ÑÐµÐºÑƒÐ½Ð´
        setInterval(() => {
            if (devicesElement.children.length > 0) {
                devicesElement.innerHTML = '<p>Clearing old devices...</p>';
            }
        }, 30000);
    </script>
</body>
</html>